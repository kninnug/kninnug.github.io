(this.webpackJsonprtc=this.webpackJsonprtc||[]).push([[0],{24:function(e,t,n){},30:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(14),a=n.n(i),c=(n(24),n(12)),s=n(11),u=n(2),p=n(3),d=n.n(p),f=n(6),l=n(15),h=n(16),m=n(19),w=n(18),y=n(17),g=n(8),j=n(9),b=n(10);function v(e,t,n){if(n.length>255)throw new Error("String too long: "+n.length);e.setUint8(t,n.length);for(var r=0;r<n.length;r++){var o=n.charCodeAt(r);if(o>255)throw new Error("Not an ASCII character: "+n.charAt(r));e.setUint8(t+1+r,o)}return t+1+n.length}function O(e,t,n){for(var r=new DataView(n),o=0;o<n.byteLength;o++)e.setUint8(t+o,r.getUint8(o));return t+n.byteLength}function x(e,t){for(var n=e.getUint8(t),r="",o=0;o<n;o++){var i=e.getUint8(t+1+o);r+=String.fromCharCode(i)}return r}function S(e){return t=function(e){if(e.sessionVersion>7)throw new Error("sessionVersion too high: "+e.sessionVersion);if(e.candidates.length>15)throw new Error("Too many candidates: "+e.candidates.length);var t=e.candidates.map((function(e){var t=+e.foundation;if(isNaN(t)||t>Math.pow(2,32)-1)throw new Error("Foundation too big: "+e.foundation);var n=!!e.port,r=2===e.component,o="tcp"===e.transport,i="srflx"===e.type,a="active"===e.tcptype,c=5+(e.ip.length+1)+(+n?2:0)+(i?e.raddr.length+1+2:0),s=new ArrayBuffer(c),u=new DataView(s);u.setUint8(0,+n|+r<<1|+o<<2|+i<<3|+a<<4),u.setUint32(1,t);var p=v(u,5,e.ip);return e.port&&(u.setUint16(p,e.port),p+=2),i&&(p=v(u,p,e.raddr),u.setUint16(p,e.rport)),s})),n=""+e.sessionId,r=""+e.protocol,o="UDP/DTLS/SCTP"===r.toUpperCase()||"TCP/DTLS/SCTP"===r.toUpperCase(),i=e.fingerprint.split(":").map((function(e){return parseInt(e,16)})),a=e.iceUfrag,c=e.icePwd,s=37+n.length+1+ +!o*r.length+1+a.length+1+c.length+1+t.reduce((function(e,t){return e+t.byteLength}),0),u=new ArrayBuffer(s),p=new DataView(u);p.setUint8(0,+("answer"===e.type)|(7&e.sessionVersion)<<1|(15&t.length)<<4),p.setUint16(1,e.port);var d,f=3,l=Object(g.a)(i);try{for(l.s();!(d=l.n()).done;){var h=d.value;p.setUint8(f++,h)}}catch(y){l.e(y)}finally{l.f()}p.setUint16(f,e.maxMessageSize),f=v(p,f+=2,n),"UDP/DTLS/SCTP"===r.toUpperCase()?(p.setUint8(f,0),f+=1):"TCP/DTLS/SCTP"===r.toUpperCase()?(p.setUint8(f,1),f+=1):f=v(p,f,r),f=v(p,f,a),f=v(p,f,c);var m,w=Object(g.a)(t);try{for(w.s();!(m=w.n()).done;)f=O(p,f,m.value)}catch(y){w.e(y)}finally{w.f()}return u}(function(e){if(!e.sdp)throw new Error("No SDP");if("answer"!==e.type&&"offer"!==e.type)throw new Error("Unexpected RTC init type: "+e.type);var t=j.parse(e.sdp);if(!t.origin)throw new Error("Incomplete SDP: no origin");if(!t.media||!t.media.length)throw new Error("Incomplete SDP: no/zero-length media");if(t.media.length>1)throw new Error("Too much SDP: more than 1 media");var n=t.media[0],r=n.fingerprint||t.fingerprint;if(!n.candidates)throw new Error("Incomplete SDP.media: no candidates");if(!r)throw new Error("Incomplete SDP: no fingerprint");if("sha-256"!==r.type)throw new Error("Unexpected fingerprint type: "+r.type);if(!n.iceUfrag)throw new Error("Incomplete SDP: no ice-ufrag");if(!n.icePwd)throw new Error("Incomplete SDP: no ice-pwd");return{type:e.type,sessionId:""+t.origin.sessionId,sessionVersion:t.origin.sessionVersion,port:n.port,protocol:n.protocol,candidates:n.candidates.sort((function(e,t){return+e.priority-+t.priority})).map((function(e,t){if(1!==e.component&&2!==e.component)throw new Error("Unexpected value for candidate component: "+e.component);var r=e.transport.toLowerCase();if("tcp"!==r&&"udp"!==r)throw new Error("Unexpected value for candidate transport: "+e.transport);if("host"!==e.type&&"srflx"!==e.type)throw new Error("Unexpected value for candidate type: "+e.type);if(void 0!==e.tcptype&&"active"!==e.tcptype&&"passive"!==e.tcptype)throw new Error("Unexpected value for candidate tcp-type: "+e.tcptype);return{foundation:+e.foundation,component:e.component,transport:r,ip:e.ip,port:e.port===n.port?void 0:e.port,type:e.type,raddr:e.raddr,rport:e.rport,tcptype:e.tcptype}})),iceUfrag:n.iceUfrag,icePwd:n.icePwd,fingerprint:r.hash,maxMessageSize:n.maxMessageSize}}(e)),b.b(new Uint8Array(t));var t}function U(e){return{type:(t=function(e){var t=0,n=new DataView(e),r=n.getUint8(t++),o=1&r?"answer":"offer",i=r>>1&7,a=r>>4&15,c=n.getUint16(1);t+=2;var s=new Array(32).fill(0).map((function(e,r){return n.getUint8(t+r).toString(16).padStart(2,"0").toUpperCase()})).join(":");t+=32;var u=n.getUint16(t),p=x(n,t+=2);t+=p.length+1;var d=n.getUint8(t),f=void 0;0===d?(f="UDP/DTLS/SCTP",t++):1===d?(f="TCP/DTLS/SCTP",t++):(f=x(n,t),t+=f.length+1);var l=x(n,t);t+=l.length+1;var h=x(n,t);t+=h.length+1;for(var m=[],w=0;w<a;w++){var y={},g=n.getUint8(t++),j=1&g;y.component=g>>1&1?2:1,y.transport=g>>2&1?"tcp":"udp",y.type=g>>3&1?"srflx":"host",y.tcptype=g>>4&1?"passive":"active",y.foundation=n.getUint32(t),t+=4,y.ip=x(n,t),t+=y.ip.length+1,j&&(y.port=n.getUint16(t),t+=2),"srflx"===y.type&&(y.raddr=x(n,t),t+=y.raddr.length+1,y.rport=n.getUint16(t),t+=2),m.push(y)}return{type:o,sessionId:p,sessionVersion:i,port:c,protocol:f,iceUfrag:l,icePwd:h,fingerprint:s,maxMessageSize:u,candidates:m}}(function(e){return b.a(e).buffer}(e))).type,sdp:j.write({version:0,origin:{username:"-",sessionId:t.sessionId,sessionVersion:t.sessionVersion,netType:"IN",ipVer:4,address:"127.0.0.1"},name:"-",timing:{start:0,stop:0},groups:[{type:"BUNDLE",mids:"0"}],msidSemantic:{semantic:"",token:"WMS"},media:[{direction:"sendrecv",rtp:[],fmtp:[],type:"application",port:t.port,protocol:t.protocol,payloads:"webrtc-datachannel",connection:{version:4,ip:"127.0.0.1"},candidates:t.candidates.map((function(e,n){var r,o,i;return{foundation:""+e.foundation,component:e.component,transport:e.transport,priority:n,ip:e.ip,port:null!==(r=e.port)&&void 0!==r?r:t.port,type:e.type,raddr:null!==(o=e.raddr)&&void 0!==o?o:void 0,rport:null!==(i=e.rport)&&void 0!==i?i:void 0,tcptype:"tcp"===e.transport?e.tcptype:void 0}})),endOfCandidates:"end-of-candidates",iceUfrag:t.iceUfrag,icePwd:t.icePwd,iceOptions:"trickle",fingerprint:{type:"sha-256",hash:t.fingerprint},setup:"offer"===t.type?"actpass":"active",stcpPort:5e3,mid:"0",maxMessageSize:t.maxMessageSize}]})+"a=sctp-port:5000\r\n"};var t}var C=n(1),E=[{urls:["stun:stun.l.google.com:19302"]}],P=function(e){Object(m.a)(n,e);var t=Object(w.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this)).conn=void 0,r.chan=void 0,r.mode=void 0,r.isReady=void 0,r.send=void 0,r.conn=new RTCPeerConnection({iceServers:e}),r.mode=void 0,r.isReady=!1,r.send=function(){throw new Error("RTC connection not open yet")},r}return Object(h.a)(n,[{key:"initiate",value:function(){var e=Object(f.a)(d.a.mark((function e(){var t,n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chan){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("RTC connection already open")));case 2:if(!this.mode){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("RTC connection already initiated")));case 4:return this.mode="host",t=this.conn,e.abrupt("return",new Promise((function(e,r){var o=n.chan=t.createDataChannel("test");o.onopen=function(e){n.isReady=!0,n.send=o.send.bind(o),n.emit("ready",o)},o.onmessage=function(e){n.emit("message",e.data)},t.onicecandidate=function(n){!n.candidate&&t.localDescription&&e(t.localDescription)},t.createOffer({}).then((function(e){return t.setLocalDescription(e)})).catch(r)})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"answer",value:function(){var e=Object(f.a)(d.a.mark((function e(t){var n,r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chan){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("RTC connection already open")));case 2:if(!this.mode){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("RTC connection already initiated")));case 4:return this.mode="client",n=this.conn,e.abrupt("return",new Promise((function(e,o){n.ondatachannel=function(e){var t=r.chan=e.channel;t.onopen=function(e){r.isReady=!0,r.send=t.send.bind(t),r.emit("ready",t)},t.onmessage=function(e){r.emit("message",e.data)}},n.onicecandidate=function(t){!t.candidate&&n.localDescription&&e(n.localDescription)};var i=new RTCSessionDescription(t);n.setRemoteDescription(i),n.createAnswer({}).then((function(e){return n.setLocalDescription(e)})).catch(o)})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"accept",value:function(){var e=Object(f.a)(d.a.mark((function e(t){var n,r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("host"===this.mode){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("Can only accept an RTC answer as host")));case 2:return n=this.conn,e.abrupt("return",new Promise((function(e,o){n.setRemoteDescription(t),e(r)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(y.TypedEmitter);function D(e){var t=Object(r.useState)((function(){return new P(E)})),n=Object(u.a)(t,1)[0],o=Object(r.useRef)(null),i=Object(r.useRef)(null),a=Object(r.useState)(null),c=Object(u.a)(a,2),s=c[0],p=c[1],d=Object(r.useState)(""),f=Object(u.a)(d,2),l=f[0],h=f[1],m=Object(r.useState)(""),w=Object(u.a)(m,2),y=w[0],g=w[1],j=Object(r.useState)(n.isReady),b=Object(u.a)(j,2),v=b[0],O=b[1];return Object(r.useEffect)((function(){v||n.isReady||n.initiate().then((function(e){return p(e)}))}),[n,v]),Object(r.useEffect)((function(){var e=function(){return O(!0)};return n.on("ready",e),function(){n.off("ready",e)}}),[n]),Object(r.useEffect)((function(){if(l&&!n.isReady&&!v)try{var e=U(l);n.accept(e)}catch(t){console.error(t),g("That was not a valid code, please try again"),h("")}}),[l]),v?Object(C.jsx)(R,{rtc:n}):s&&Object(C.jsxs)("section",{children:[Object(C.jsx)("p",{children:"Share this link with the person you want to talk to:"}),Object(C.jsx)("input",{ref:o,type:"text",value:function(e){var t=new URL(window.location.href);return t.hash=e,t.toString()}(S(s)),onClick:function(){return o.current.select()},onChange:function(){}}),Object(C.jsx)("button",{onClick:function(){var e;o.current.select(),document.execCommand("copy"),null===(e=i.current)||void 0===e||e.focus()},children:"Copy"}),Object(C.jsx)("p",{children:"Paste their response code here:"}),Object(C.jsx)("input",{ref:i,type:"text",value:l,onChange:function(e){return h(e.target.value)}}),y&&Object(C.jsx)("p",{children:y})]})}function T(e){var t=Object(r.useState)((function(){return new P(E)})),n=Object(u.a)(t,1)[0],o=e.code,i=Object(r.useRef)(null),a=Object(r.useState)(null),c=Object(u.a)(a,2),s=c[0],p=c[1],d=Object(r.useState)(n.isReady),f=Object(u.a)(d,2),l=f[0],h=f[1];return Object(r.useEffect)((function(){var e=function(){return h(!0)};return n.on("ready",e),function(){n.off("ready",e)}}),[n]),Object(r.useEffect)((function(){l||n.isReady||n.answer(U(o)).then((function(e){return p(e)}))}),[o,l]),l?Object(C.jsx)(R,{rtc:n}):s&&Object(C.jsxs)("section",{children:[Object(C.jsx)("p",{children:"Send this code back to the person that sent you here:"}),Object(C.jsx)("input",{ref:i,type:"text",value:S(s),onChange:function(){},onClick:function(){return i.current.select()}}),Object(C.jsx)("button",{onClick:function(){i.current.select(),document.execCommand("copy")},children:"Copy"})]})}function k(e){function t(e){return(""+e).padStart(2,"0")}return e.getFullYear()+"-"+t(e.getMonth())+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}function R(e){var t=e.rtc,n=Object(r.useState)((function(){return[{name:"System",message:"You can now talk to each other!",time:new Date,rando:Math.random()}]})),o=Object(u.a)(n,2),i=o[0],a=o[1],p=Object(r.useState)(""),d=Object(u.a)(p,2),f=d[0],l=d[1],h=Object(r.useRef)(null),m=Object(r.useRef)(null);function w(){var e={name:"You",message:f,time:new Date,rando:Math.random()};t.send(JSON.stringify(e)),a((function(t){return[].concat(Object(s.a)(t),[e])})),l("")}return Object(r.useEffect)((function(){window.location.hash=""}),[]),Object(r.useEffect)((function(){function e(e){var t=JSON.parse(e,(function(e,t){return"time"===e?new Date(t):t}));a((function(e){return[].concat(Object(s.a)(e),[Object(c.a)(Object(c.a)({},t),{},{name:"Them"})])}))}return t.on("message",e),function(){t.off("message",e)}}),[t]),Object(r.useEffect)((function(){m.current&&m.current.focus()}),[m.current]),Object(r.useEffect)((function(){h.current&&h.current.scrollIntoView()}),[h.current,i]),Object(C.jsxs)("section",{style:{height:"100%",width:"100%",maxWidth:"600px",display:"flex",flexFlow:"column nowrap",justifyContent:"flex-end"},children:[Object(C.jsx)("div",{style:{flex:"1",display:"flex",flexFlow:"column nowrap",justifyContent:"flex-end"},children:i.map((function(e){return Object(C.jsxs)("p",{style:{margin:"0.5em 0.5em",wordBreak:"break-all",textIndent:"-1em",paddingLeft:"1em"},ref:h,children:[Object(C.jsx)("em",{children:k(e.time)}),"\xa0",Object(C.jsx)("strong",{children:e.name}),":\xa0",e.message]},e.time.toISOString()+""+e.rando)}))}),Object(C.jsxs)("div",{style:{flex:"0",display:"flex"},children:[Object(C.jsx)("input",{style:{margin:"0.5em 0.25em 0.5em 0.25em",flex:"10"},ref:m,type:"text",value:f,onChange:function(e){return l(e.target.value)},onKeyUp:function(e){return"Enter"===e.key&&w()}}),Object(C.jsx)("button",{style:{margin:"0.5em 0.5em 0.5em 0.25em",flex:"0"},onClick:w,children:"Send"})]})]})}var I=function(){var e=Object(r.useState)(window.location.hash.substr(1)),t=Object(u.a)(e,1)[0];return t&&t.length?Object(C.jsx)(T,{code:decodeURIComponent(t)}):Object(C.jsx)(D,{})};a.a.render(Object(C.jsx)(o.a.StrictMode,{children:Object(C.jsx)(I,{})}),document.getElementById("root"))}},[[30,1,2]]]);
//# sourceMappingURL=main.113a3d94.chunk.js.map