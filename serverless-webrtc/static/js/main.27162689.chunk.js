(this.webpackJsonprtc=this.webpackJsonprtc||[]).push([[0],{23:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(13),c=n.n(i),a=(n(23),n(11)),s=n(6),p=n(2),u=n(4),d=n.n(u),l=n(8),f=n(14),h=n(15),j=n(18),m=n(17),y=n(16),g=n(10),b=n(3);function w(e,t,n){if(n.length>255)throw new Error("String too long: "+n.length);e.setUint8(t,n.length);for(var r=0;r<n.length;r++){var o=n.charCodeAt(r);if(o>255)throw new Error("Not an ASCII character: "+n.charAt(r));e.setUint8(t+1+r,o)}return t+1+n.length}function v(e,t,n){for(var r=new DataView(n),o=0;o<n.byteLength;o++)e.setUint8(t+o,r.getUint8(o));return t+n.byteLength}function O(e,t){for(var n=e.getUint8(t),r="",o=0;o<n;o++){var i=e.getUint8(t+1+o);r+=String.fromCharCode(i)}return r}function x(e){return t=function(e){if(e.sessionVersion>7)throw new Error("sessionVersion too high: "+e.sessionVersion);if(e.candidates.length>15)throw new Error("Too many candidates: "+e.candidates.length);var t=e.candidates.map((function(e){var t=+e.foundation;if(isNaN(t)||t>Math.pow(2,32)-1)throw new Error("Foundation too big: "+e.foundation);var n=!!e.port,r=2===e.component,o="tcp"===e.transport,i="srflx"===e.type,c="active"===e.tcptype,a=5+(e.ip.length+1)+(+n?2:0)+(i?e.raddr.length+1+2:0),s=new ArrayBuffer(a),p=new DataView(s);p.setUint8(0,+n|+r<<1|+o<<2|+i<<3|+c<<4),p.setUint32(1,t);var u=w(p,5,e.ip);return e.port&&(p.setUint16(u,e.port),u+=2),i&&(u=w(p,u,e.raddr),p.setUint16(u,e.rport)),s})),n=""+e.sessionId,r=""+e.protocol,o="UDP/DTLS/SCTP"===r.toUpperCase()||"TCP/DTLS/SCTP"===r.toUpperCase(),i=e.fingerprint.split(":").map((function(e){return parseInt(e,16)})),c=e.iceUfrag,a=e.icePwd,s=37+n.length+1+ +!o*r.length+1+c.length+1+a.length+1+t.reduce((function(e,t){return e+t.byteLength}),0),p=new ArrayBuffer(s),u=new DataView(p);u.setUint8(0,+("answer"===e.type)|(7&e.sessionVersion)<<1|(15&t.length)<<4),u.setUint16(1,e.port);var d,l=3,f=Object(g.a)(i);try{for(f.s();!(d=f.n()).done;){var h=d.value;u.setUint8(l++,h)}}catch(y){f.e(y)}finally{f.f()}u.setUint16(l,e.maxMessageSize),l=w(u,l+=2,n),"UDP/DTLS/SCTP"===r.toUpperCase()?(u.setUint8(l,0),l+=1):"TCP/DTLS/SCTP"===r.toUpperCase()?(u.setUint8(l,1),l+=1):l=w(u,l,r),l=w(u,l,c),l=w(u,l,a);var j,m=Object(g.a)(t);try{for(m.s();!(j=m.n()).done;)l=v(u,l,j.value)}catch(y){m.e(y)}finally{m.f()}return p}(function(e){if(!e.sdp)throw new Error("No SDP");if("answer"!==e.type&&"offer"!==e.type)throw new Error("Unexpected RTC init type: "+e.type);var t=b.parse(e.sdp);if(!t.origin)throw new Error("Incomplete SDP: no origin");if(!t.media||!t.media.length)throw new Error("Incomplete SDP: no/zero-length media");if(t.media.length>1)throw new Error("Too much SDP: more than 1 media");var n=t.media[0],r=n.fingerprint||t.fingerprint;if(!n.candidates)throw new Error("Incomplete SDP.media: no candidates");if(!r)throw new Error("Incomplete SDP: no fingerprint");if("sha-256"!==r.type)throw new Error("Unexpected fingerprint type: "+r.type);if(!n.iceUfrag)throw new Error("Incomplete SDP: no ice-ufrag");if(!n.icePwd)throw new Error("Incomplete SDP: no ice-pwd");return{type:e.type,sessionId:""+t.origin.sessionId,sessionVersion:t.origin.sessionVersion,port:n.port,protocol:n.protocol,candidates:n.candidates.sort((function(e,t){return+e.priority-+t.priority})).map((function(e,t){if(1!==e.component&&2!==e.component)throw new Error("Unexpected value for candidate component: "+e.component);var r=e.transport.toLowerCase();if("tcp"!==r&&"udp"!==r)throw new Error("Unexpected value for candidate transport: "+e.transport);if("host"!==e.type&&"srflx"!==e.type)throw new Error("Unexpected value for candidate type: "+e.type);if(void 0!==e.tcptype&&"active"!==e.tcptype&&"passive"!==e.tcptype)throw new Error("Unexpected value for candidate tcp-type: "+e.tcptype);return{foundation:+e.foundation,component:e.component,transport:r,ip:e.ip,port:e.port===n.port?void 0:e.port,type:e.type,raddr:e.raddr,rport:e.rport,tcptype:e.tcptype}})),iceUfrag:n.iceUfrag,icePwd:n.icePwd,fingerprint:r.hash,maxMessageSize:n.maxMessageSize}}(e)),btoa(String.fromCharCode.apply(String,Object(s.a)(new Uint8Array(t))));var t}function S(e){return{type:(t=function(e){var t=0,n=new DataView(e),r=n.getUint8(t++),o=1&r?"answer":"offer",i=r>>1&7,c=r>>4&15,a=n.getUint16(1);t+=2;var s=new Array(32).fill(0).map((function(e,r){return n.getUint8(t+r).toString(16).padStart(2,"0").toUpperCase()})).join(":");t+=32;var p=n.getUint16(t),u=O(n,t+=2);t+=u.length+1;var d=n.getUint8(t),l=void 0;0===d?(l="UDP/DTLS/SCTP",t++):1===d?(l="TCP/DTLS/SCTP",t++):(l=O(n,t),t+=l.length+1);var f=O(n,t);t+=f.length+1;var h=O(n,t);t+=h.length+1;for(var j=[],m=0;m<c;m++){var y={},g=n.getUint8(t++),b=1&g;y.component=g>>1&1?2:1,y.transport=g>>2&1?"tcp":"udp",y.type=g>>3&1?"srflx":"host",y.tcptype=g>>4&1?"passive":"active",y.foundation=n.getUint32(t),t+=4,y.ip=O(n,t),t+=y.ip.length+1,b&&(y.port=n.getUint16(t),t+=2),"srflx"===y.type&&(y.raddr=O(n,t),t+=y.raddr.length+1,y.rport=n.getUint16(t),t+=2),j.push(y)}return{type:o,sessionId:u,sessionVersion:i,port:a,protocol:l,iceUfrag:f,icePwd:h,fingerprint:s,maxMessageSize:p,candidates:j}}(function(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)})).buffer}(e))).type,sdp:b.write({version:0,origin:{username:"-",sessionId:t.sessionId,sessionVersion:t.sessionVersion,netType:"IN",ipVer:4,address:"127.0.0.1"},name:"-",timing:{start:0,stop:0},groups:[{type:"BUNDLE",mids:"0"}],msidSemantic:{semantic:"",token:"WMS"},media:[{direction:"sendrecv",rtp:[],fmtp:[],type:"application",port:t.port,protocol:t.protocol,payloads:"webrtc-datachannel",connection:{version:4,ip:"127.0.0.1"},candidates:t.candidates.map((function(e,n){var r,o,i;return{foundation:""+e.foundation,component:e.component,transport:e.transport,priority:n,ip:e.ip,port:null!==(r=e.port)&&void 0!==r?r:t.port,type:e.type,raddr:null!==(o=e.raddr)&&void 0!==o?o:void 0,rport:null!==(i=e.rport)&&void 0!==i?i:void 0,tcptype:"tcp"===e.transport?e.tcptype:void 0}})),endOfCandidates:"end-of-candidates",iceUfrag:t.iceUfrag,icePwd:t.icePwd,iceOptions:"trickle",fingerprint:{type:"sha-256",hash:t.fingerprint},setup:"offer"===t.type?"actpass":"active",stcpPort:5e3,mid:"0",maxMessageSize:t.maxMessageSize}]})+"a=sctp-port:5000\r\n"};var t}var C=n(0);function U(e){return JSON.stringify(e,null,"  ")}function D(e){return S(x(e))}var E=[{urls:["stun:stun.l.google.com:19302"]}],P=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this)).conn=void 0,r.channel=void 0,r.mode=void 0,r.isReady=void 0,r.send=void 0,r.conn=new RTCPeerConnection({iceServers:e}),r.mode=void 0,r.isReady=!1,r.send=function(){throw new Error("RTC connection not open yet")},r}return Object(h.a)(n,[{key:"initiate",value:function(){var e=Object(l.a)(d.a.mark((function e(){var t,n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.channel){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("RTC connection already open")));case 2:if(!this.mode){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("RTC connection already initiated")));case 4:return this.mode="host",t=this.conn,e.abrupt("return",new Promise((function(e,r){var o=n.channel=t.createDataChannel("test");o.onopen=function(e){n.isReady=!0,n.send=o.send.bind(o),console.log("connection established"),n.emit("ready",o)},o.onmessage=function(e){n.emit("message",e.data)},t.onicecandidate=function(n){console.log("host ice candidate",n.candidate),!n.candidate&&t.localDescription&&(console.log("offering",t.localDescription.sdp),e(t.localDescription))},t.createOffer({}).then((function(e){return t.setLocalDescription(e)})).catch(r)})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"answer",value:function(){var e=Object(l.a)(d.a.mark((function e(t){var n,r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.channel){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("RTC connection already open")));case 2:if(!this.mode){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("RTC connection already initiated")));case 4:return this.mode="client",n=this.conn,e.abrupt("return",new Promise((function(e,o){n.ondatachannel=function(e){var t=r.channel=e.channel;t.onopen=function(e){r.isReady=!0,r.send=t.send.bind(t),console.log("connection established"),r.emit("ready",t)},t.onmessage=function(e){r.emit("message",e.data)}},n.onicecandidate=function(t){console.log("client ice candidate",t.candidate),!t.candidate&&n.localDescription&&(console.log("answering with",n.localDescription.sdp),e(n.localDescription))},console.log("answering to",t.sdp);var i=new RTCSessionDescription(t);n.setRemoteDescription(i),n.createAnswer({}).then((function(e){return n.setLocalDescription(e)})).catch(o)})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"accept",value:function(){var e=Object(l.a)(d.a.mark((function e(t){var n,r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("host"===this.mode){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("Can only accept an RTC answer as host")));case 2:return n=this.conn,e.abrupt("return",new Promise((function(e,o){console.log("accepting to",t.sdp),n.setRemoteDescription(t),e(r)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(y.TypedEmitter);function T(e){var t=Object(r.useState)((function(){return new P(E)})),n=Object(p.a)(t,1)[0],o=Object(r.useRef)(null),i=Object(r.useRef)(null),c=Object(r.useState)(null),a=Object(p.a)(c,2),s=a[0],u=a[1],d=Object(r.useState)(""),l=Object(p.a)(d,2),f=l[0],h=l[1],j=Object(r.useState)(""),m=Object(p.a)(j,2),y=m[0],g=m[1],w=Object(r.useState)(n.isReady),v=Object(p.a)(w,2),O=v[0],T=v[1];return Object(r.useEffect)((function(){O||n.isReady||n.initiate().then((function(e){return u(e)}))}),[n,O]),Object(r.useEffect)((function(){var e=function(){return T(!0)};return n.on("ready",e),function(){n.off("ready",e)}}),[n]),Object(r.useEffect)((function(){if(f&&!n.isReady&&!O)try{var e=S(f);n.accept(e).catch((function(e){throw e}))}catch(t){console.error(t),g("That was not a valid code, please try again"),h("")}}),[f]),O?Object(C.jsx)(I,{rtc:n}):s&&Object(C.jsxs)("section",{style:{display:"flex",flexFlow:"row nowrap"},children:[Object(C.jsxs)("div",{style:{flex:"1"},children:[Object(C.jsx)("p",{children:"Share this link with the person you want to talk to:"}),Object(C.jsx)("input",{ref:o,type:"text",value:function(e){var t=new URL(window.location.href);return t.hash=e,t.toString()}(x(s)),onClick:function(){return o.current.select()},onChange:function(){}}),Object(C.jsx)("button",{onClick:function(){var e;o.current.select(),document.execCommand("copy"),null===(e=i.current)||void 0===e||e.focus()},children:"Copy"}),Object(C.jsx)("p",{children:"Paste their response code here:"}),Object(C.jsx)("input",{ref:i,type:"text",value:f,onChange:function(e){return h(e.target.value)}}),y&&Object(C.jsx)("p",{children:y})]}),Object(C.jsxs)("div",{style:{flex:"1"},children:[Object(C.jsx)("pre",{children:s.sdp&&U(b.parse(s.sdp))}),Object(C.jsx)("pre",{children:s.sdp&&s.sdp})]}),Object(C.jsxs)("div",{style:{flex:"1"},children:[Object(C.jsx)("pre",{children:s.sdp&&U(b.parse(D(s).sdp))}),Object(C.jsx)("pre",{children:s.sdp&&D(s).sdp})]})]})}function R(e){var t=Object(r.useState)((function(){return new P(E)})),n=Object(p.a)(t,1)[0],o=e.code,i=Object(r.useRef)(null),c=Object(r.useState)(null),a=Object(p.a)(c,2),s=a[0],u=a[1],d=Object(r.useState)(n.isReady),l=Object(p.a)(d,2),f=l[0],h=l[1];return Object(r.useEffect)((function(){var e=function(){return h(!0)};return n.on("ready",e),function(){n.off("ready",e)}}),[n]),Object(r.useEffect)((function(){f||n.isReady||n.answer(S(o)).then((function(e){return u(e)}))}),[o,f]),f?Object(C.jsx)(I,{rtc:n}):s&&Object(C.jsxs)("section",{style:{display:"flex",flexFlow:"row nowrap"},children:[Object(C.jsxs)("div",{style:{flex:"1"},children:[Object(C.jsx)("p",{children:"Send this code back to the person that sent you here:"}),Object(C.jsx)("input",{ref:i,type:"text",value:x(s),onChange:function(){},onClick:function(){return i.current.select()}}),Object(C.jsx)("button",{onClick:function(){i.current.select(),document.execCommand("copy")},children:"Copy"})]}),Object(C.jsxs)("div",{style:{flex:"1"},children:[Object(C.jsx)("pre",{children:s.sdp&&U(b.parse(s.sdp))}),Object(C.jsx)("pre",{children:s.sdp&&s.sdp})]}),Object(C.jsxs)("div",{style:{flex:"1"},children:[Object(C.jsx)("pre",{children:s.sdp&&U(b.parse(D(s).sdp))}),Object(C.jsx)("pre",{children:s.sdp&&D(s).sdp})]})]})}function k(e){function t(e){return(""+e).padStart(2,"0")}return e.getFullYear()+"-"+t(e.getMonth())+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}function I(e){var t=e.rtc,n=Object(r.useState)((function(){return[{name:"System",message:"You can now talk to each other!",time:new Date,rando:Math.random()}]})),o=Object(p.a)(n,2),i=o[0],c=o[1],u=Object(r.useState)(""),d=Object(p.a)(u,2),l=d[0],f=d[1],h=Object(r.useRef)(null),j=Object(r.useRef)(null);function m(){var e={name:"You",message:l,time:new Date,rando:Math.random()};t.send(JSON.stringify(e)),c((function(t){return[].concat(Object(s.a)(t),[e])})),f("")}return Object(r.useEffect)((function(){window.location.hash=""}),[]),Object(r.useEffect)((function(){function e(e){var t=JSON.parse(e,(function(e,t){return"time"===e?new Date(t):t}));c((function(e){return[].concat(Object(s.a)(e),[Object(a.a)(Object(a.a)({},t),{},{name:"Them"})])}))}return t.on("message",e),function(){t.off("message",e)}}),[t]),Object(r.useEffect)((function(){t.channel&&(t.channel.onerror=function(e){console.error("channel error",e),c((function(e){return[].concat(Object(s.a)(e),[{name:"System",message:"RTC error: ",time:new Date,rando:Math.random()}])}))})}),[t.channel]),Object(r.useEffect)((function(){j.current&&j.current.focus()}),[j.current]),Object(r.useEffect)((function(){h.current&&h.current.scrollIntoView()}),[i]),Object(C.jsxs)("section",{style:{height:"100%",width:"100%",maxWidth:"600px",display:"flex",flexFlow:"column nowrap",justifyContent:"flex-end"},children:[Object(C.jsx)("div",{style:{flex:"1",display:"flex",flexFlow:"column nowrap",justifyContent:"flex-end"},children:i.map((function(e){return Object(C.jsxs)("p",{style:{margin:"0.5em 0.5em",wordBreak:"break-all",textIndent:"-1em",paddingLeft:"1em"},ref:h,children:[Object(C.jsx)("em",{children:k(e.time)}),"\xa0",Object(C.jsx)("strong",{children:e.name}),":\xa0",e.message]},e.time.toISOString()+""+e.rando)}))}),Object(C.jsxs)("div",{style:{flex:"0",display:"flex"},children:[Object(C.jsx)("input",{style:{margin:"0.5em 0.25em 0.5em 0.25em",flex:"10"},ref:j,type:"text",value:l,onChange:function(e){return f(e.target.value)},onKeyUp:function(e){return"Enter"===e.key&&m()}}),Object(C.jsx)("button",{style:{margin:"0.5em 0.5em 0.5em 0.25em",flex:"0"},onClick:m,children:"Send"})]})]})}var L=function(){var e=Object(r.useState)(window.location.hash.substr(1)),t=Object(p.a)(e,1)[0];return t&&t.length?Object(C.jsx)(R,{code:decodeURIComponent(t)}):Object(C.jsx)(T,{})};c.a.render(Object(C.jsx)(o.a.StrictMode,{children:Object(C.jsx)(L,{})}),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.27162689.chunk.js.map